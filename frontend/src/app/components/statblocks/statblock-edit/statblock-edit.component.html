<div class="edit-container">
  <!-- Left Sidebar -->
  <div class="sidebar">
    <!-- Compact Toolbar Layout (visible on small screens) -->
    <div class="toolbar-layout">
      <!-- Row 1: Title, Mode Switcher, Search -->
      <div class="toolbar-row">
        <span class="toolbar-title">Statblocks</span>
        
        <div class="mode-buttons">
          <button mat-raised-button color="accent" class="mode-button current-mode">
            <mat-icon>edit</mat-icon>
            Edit
          </button>
          <button mat-raised-button color="primary" (click)="switchToViewMode()" class="mode-button">
            <mat-icon>view_list</mat-icon>
            View
          </button>
        </div>
        
        <mat-form-field appearance="outline" class="toolbar-search">
          <mat-label>Search</mat-label>
          <input matInput [formControl]="searchControl" placeholder="Search names and tags...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
        
        <button mat-button (click)="clearFilters()" class="toolbar-button">
          <mat-icon>clear</mat-icon>
        </button>
      </div>
      
      <!-- Row 2: Actions and Selection Controls -->
      <div class="toolbar-row">
        <button mat-raised-button color="primary" (click)="addNewRow()" class="toolbar-button">
          <mat-icon>add</mat-icon>
          Add New
        </button>
        
        <mat-checkbox (change)="$event ? toggleAllRows() : null"
                      [checked]="isAllSelected()"
                      [indeterminate]="isIndeterminate()"
                      class="toolbar-checkbox">
          Select All
        </mat-checkbox>
        
        <button mat-raised-button color="warn" (click)="deleteSelected()" 
                [disabled]="selection.selected.length === 0" class="toolbar-button">
          <mat-icon>delete</mat-icon>
          Delete ({{selection.selected.length}})
        </button>
        
        <span class="toolbar-spacer"></span>
        <span class="statblock-count">{{ editableRows.length }} statblocks</span>
      </div>
    </div>

    <!-- Sidebar Layout (visible on large screens) -->
    <div class="sidebar-layout">
      <!-- Mode Switcher Header -->
      <div class="sidebar-header">
        <h3>Statblocks</h3>
        <div class="mode-buttons">
          <button mat-raised-button 
                  color="accent"
                  class="mode-button current-mode">
            <mat-icon>edit</mat-icon>
            Edit
          </button>
          
          <button mat-raised-button 
                  color="primary"
                  (click)="switchToViewMode()"
                  class="mode-button">
            <mat-icon>view_list</mat-icon>
            View
          </button>
        </div>
      </div>

      <!-- Search Section -->
      <div class="sidebar-section">
        <h4>Search & Filters</h4>
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Search</mat-label>
          <input matInput [formControl]="searchControl" placeholder="Search names and tags...">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
        
        <div class="filter-actions">
          <button mat-button (click)="clearFilters()" class="clear-button">
            <mat-icon>clear</mat-icon>
            Clear Filters
          </button>
        </div>
      </div>

      <!-- Actions Section -->
      <div class="sidebar-section">
        <h4>Actions</h4>
        <button mat-raised-button color="primary" (click)="addNewRow()" class="full-width action-button">
          <mat-icon>add</mat-icon>
          Add New Statblock
        </button>
      </div>

      <!-- Selection Section -->
      <div class="sidebar-section">
        <h4>Selection</h4>
        <mat-checkbox (change)="$event ? toggleAllRows() : null"
                      [checked]="isAllSelected()"
                      [indeterminate]="isIndeterminate()"
                      class="select-all-checkbox">
          Select All
        </mat-checkbox>
        
        <button mat-raised-button 
                color="warn" 
                (click)="deleteSelected()" 
                [disabled]="selection.selected.length === 0"
                class="full-width action-button delete-button">
          <mat-icon>delete</mat-icon>
          Delete Selected ({{selection.selected.length}})
        </button>
      </div>

      <!-- Info Section -->
      <div class="sidebar-section">
        <span class="statblock-count">{{ editableRows.length }} statblocks</span>
      </div>
    </div>
  </div>

  <!-- Main Content Area -->
  <div class="main-content">
    <div class="statblocks-list">
      @for (row of editableRows; track row) {
        <div class="statblock-row" 
             [class.new-row]="row.isNew"
             [class.unsaved-row]="row.hasUnsavedChanges">
          
          <!-- Row Header with Actions and Selection -->
          <div class="row-header">
            <mat-checkbox (change)="$event ? selection.toggle(row) : null"
                         [checked]="selection.isSelected(row)">
            </mat-checkbox>
            <button mat-icon-button color="primary" (click)="saveRow(row)" 
                    [disabled]="!row.hasUnsavedChanges" 
                    [matTooltip]="row.hasUnsavedChanges ? 'Save changes' : 'No changes to save'">
              <mat-icon>{{ row.hasUnsavedChanges ? 'save' : 'check' }}</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="deleteRow(row)">
              <mat-icon>delete</mat-icon>
            </button>
          </div>

          <!-- Main Content Area -->
          <div class="row-content">
            <!-- Top Row: Basic Info -->
            <div class="basic-info-row">
              <mat-form-field appearance="outline" class="name-field">
                <mat-label>Name</mat-label>
                <input matInput [(ngModel)]="row.name" (input)="onFieldChange(row)">
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="type-field">
                <mat-label>Type</mat-label>
                <input matInput [(ngModel)]="row.type" (input)="onFieldChange(row)" placeholder="e.g., monstrosity, beast">
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="compact-field">
                <mat-label>CR</mat-label>
                <input matInput [(ngModel)]="row.cr" (input)="onFieldChange(row)">
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="compact-field">
                <mat-label>AC</mat-label>
                <input matInput [(ngModel)]="row.ac" (input)="onFieldChange(row)" placeholder="e.g., 15 (natural armor)">
              </mat-form-field>

              <mat-form-field appearance="outline" class="compact-field">
                <mat-label>Spell Slots</mat-label>
                <input matInput [(ngModel)]="row.spellSlotsText" (input)="onSpellSlotsChange(row)" 
                       placeholder="e.g., 1 2 3 4">
              </mat-form-field>

              <mat-form-field appearance="outline" class="text-field">
                <mat-label>Tags</mat-label>
                <input matInput [(ngModel)]="row.tagsText" (input)="onTagsChange(row)" 
                       placeholder="humanoid paladin spellcaster">
              </mat-form-field>

              <mat-form-field appearance="outline" class="text-field">
                <mat-label>Resistances</mat-label>
                <textarea matInput [(ngModel)]="row.resistancesText" (input)="onResistancesChange(row)" 
                          placeholder="one per line" [rows]="getTextareaRows(row.resistancesText, resistancesTextarea)" #resistancesTextarea></textarea>
              </mat-form-field>

              <!-- Abilities with Material labels -->
              <mat-form-field appearance="outline" class="ability-field">
                <mat-label>STR</mat-label>
                <input matInput type="number" [(ngModel)]="row.str" (input)="onFieldChange(row)">
              </mat-form-field>
              <mat-form-field appearance="outline" class="ability-field">
                <mat-label>DEX</mat-label>
                <input matInput type="number" [(ngModel)]="row.dex" (input)="onFieldChange(row)">
              </mat-form-field>
              <mat-form-field appearance="outline" class="ability-field">
                <mat-label>CON</mat-label>
                <input matInput type="number" [(ngModel)]="row.con" (input)="onFieldChange(row)">
              </mat-form-field>
              <mat-form-field appearance="outline" class="ability-field">
                <mat-label>INT</mat-label>
                <input matInput type="number" [(ngModel)]="row.int" (input)="onFieldChange(row)">
              </mat-form-field>
              <mat-form-field appearance="outline" class="ability-field">
                <mat-label>WIS</mat-label>
                <input matInput type="number" [(ngModel)]="row.wis" (input)="onFieldChange(row)">
              </mat-form-field>
              <mat-form-field appearance="outline" class="ability-field">
                <mat-label>CHA</mat-label>
                <input matInput type="number" [(ngModel)]="row.cha" (input)="onFieldChange(row)">
              </mat-form-field>
            </div>

            <!-- Bottom Row: Text Fields -->
            <div class="text-fields-row">
              <mat-form-field appearance="outline" class="text-field">
                <mat-label>Attacks</mat-label>
                <textarea matInput [(ngModel)]="row.attacksText" (input)="onAttacksChange(row)" 
                          placeholder="one per line" [rows]="getTextareaRows(row.attacksText, attacksTextarea)" #attacksTextarea></textarea>
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="text-field">
                <mat-label>Spells</mat-label>
                <textarea matInput [(ngModel)]="row.spellsText" (input)="onSpellsChange(row)" 
                          placeholder="one per line" [rows]="getTextareaRows(row.spellsText, spellsTextarea)" #spellsTextarea></textarea>
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="text-field">
                <mat-label>Skills</mat-label>
                <textarea matInput [(ngModel)]="row.skillsText" (input)="onSkillsChange(row)" 
                          placeholder="one per line" [rows]="getTextareaRows(row.skillsText, skillsTextarea)" #skillsTextarea></textarea>
              </mat-form-field>
              
              <mat-form-field appearance="outline" class="text-field">
                <mat-label>Notes</mat-label>
                <textarea matInput [(ngModel)]="row.notes" (input)="onFieldChange(row)" 
                          placeholder="general notes" [rows]="getTextareaRows(row.notes, notesTextarea)" #notesTextarea></textarea>
              </mat-form-field>
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</div>
